<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è½‰ç›¤éš¨æ©ŸæŠ½ç</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background-image: url("itzy_bg.jpg"); /* æ›èƒŒæ™¯åœ–æ™‚æ”¹é€™è£¡ */
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }

    .overlay {
      background: rgba(0, 0, 0, 0.85);
      padding: 24px;
      border-radius: 18px;
      display: flex;
      gap: 24px;
      color: #fff;
      max-width: 1100px;
      width: 95%;
      box-shadow: 0 12px 40px rgba(0,0,0,0.6);
    }

    .left, .right {
      flex: 1;
      min-width: 0;
    }

    h1 {
      margin-top: 0;
      font-size: 22px;
      text-align: center;
    }

    canvas {
      display: block;
      margin: 0 auto;
      background: rgba(0,0,0,0.25);
      border-radius: 50%;
    }

    .pointer {
      width: 0;
      height: 0;
      border-left: 18px solid transparent;
      border-right: 18px solid transparent;
      border-bottom: 26px solid #ffeb3b;
      margin: 8px auto 0;
      filter: drop-shadow(0 0 6px rgba(0,0,0,0.7));
    }

    label {
      font-size: 13px;
      opacity: 0.9;
    }

    textarea {
      width: 100%;
      min-height: 90px;
      resize: vertical;
      border-radius: 10px;
      border: none;
      padding: 8px 10px;
      font-size: 13px;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 13px;
      margin-top: 4px;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      background: #ffeb3b;
      color: #333;
      font-weight: 600;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    button.secondary {
      background: #ffffff22;
      color: #fff;
      border: 1px solid #ffffff55;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .section {
      margin-bottom: 10px;
    }

    .result-wrapper {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      margin-top: 6px;
    }

    .result-box {
      flex: 1;
      max-height: 180px;
      overflow-y: auto;
      background: rgba(0,0,0,0.35);
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 13px;
    }

    .result-box p {
      margin: 4px 0;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #ffeb3b;
      color: #333;
      margin-right: 4px;
    }

    .status {
      margin-top: 6px;
      font-size: 13px;
      opacity: 0.9;
      text-align: center;
    }

    .hint {
      font-size: 12px;
      opacity: 0.8;
    }

    #catImg {
      max-width: 120px;
      display: none;
      filter: drop-shadow(0 0 8px rgba(0,0,0,0.7));
    }

    .congrats-text {
      margin-top: 6px;
      font-size: 13px;
      text-align: left;
    }

    .mode-row {
      display: flex;
      gap: 12px;
      font-size: 13px;
      margin: 4px 0 6px;
      flex-wrap: wrap;
    }

    .mode-row label {
      opacity: 1;
    }

    .twinzy-row {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
      gap: 6px;
    }

    .twinzy-row img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

.twinzy-row {
  position: absolute;
  left: 50%;                 /* æ°´å¹³ç½®ä¸­ */
  transform: translateX(-50%); /* ç²¾æº–ç½®ä¸­ */
  bottom: 100px;             /* è²¼åœ¨é»‘è‰²æ¡†æ¡†ä¸‹æ–¹ï¼Œä¾ Twinzy é«˜åº¦å¯èª¿ */
  display: flex;
  gap: 12px;
  z-index: 10;
}

.twinzy-row img {
  height: 70px;              /* ä¿æŒè‡ªç„¶æ¯”ä¾‹ï¼Œå¯è‡ªè¡Œèª¿æ•´å¤§å° */
  width: auto;
}



  </style>
</head>
<body>
  <div class="overlay">
    <div class="left">
      <h1 id="pageTitle">è½‰ç›¤éš¨æ©ŸæŠ½ç</h1>
      <div class="pointer"></div>
      <canvas id="wheel" width="380" height="380"></canvas>
      <div class="status" id="statusText">è«‹å…ˆè¨­å®šæŠ½çåç¨±ã€çå“èˆ‡åƒåŠ è€…ï¼ŒæŒ‰ã€Œå¥—ç”¨è¨­å®šã€ã€‚</div>
      <div class="btn-row" style="justify-content:center; margin-top:10px;">
        <button id="spinBtn" disabled>ğŸ¯ é–‹å§‹æŠ½çï¼ˆä¸€æ¬¡æŠ½å®Œæ‰€æœ‰çå“ï¼‰</button>
        <button id="resetBtn" class="secondary">é‡ç½®çµæœ</button>
      </div>
    </div>

    <div class="right">
      <div class="section">
        <label for="drawTitle">æ­¤æ¬¡æŠ½çåç¨±ï¼š</label>
        <input id="drawTitle" type="text" placeholder="ä¾‹å¦‚ï¼šITZY å°åŒ—å°å¡æŠ½ç" />
        <div class="hint">èªªæ˜ï¼šæœƒé¡¯ç¤ºåœ¨è½‰ç›¤ä¸Šæ–¹çš„å¤§æ¨™é¡Œï¼Œä¹Ÿæœƒå¥—ç”¨åˆ°ç€è¦½å™¨åˆ†é æ¨™é¡Œã€‚</div>
      </div>

      <div class="section">
        <label for="prizes">çå“æ¸…å–®ï¼ˆä¸€è¡Œä¸€å€‹ï¼‰ï¼š</label>
        <textarea id="prizes" placeholder="ä¾‹å¦‚ï¼š&#10;ä¸€çï¼šç°½åå°å¡&#10;äºŒçï¼šæ‡‰æ´æ‰‡&#10;ä¸‰çï¼šç…§ç‰‡çµ„"></textarea>
        <div class="hint">èªªæ˜ï¼šæœ‰å¹¾è¡Œçå“ï¼Œå°±æœƒæŠ½å‡ºå¹¾ä½ä¸­çè€…ã€‚</div>
      </div>

      <div class="section">
        <label>åƒåŠ è€…è¨­å®šï¼š</label>
        <div class="mode-row">
          <label>
            <input type="radio" name="participantMode" value="manual" checked />
            æ‰‹å‹•è¼¸å…¥åå–®
          </label>
          <label>
            <input type="radio" name="participantMode" value="count" />
            è¼¸å…¥äººæ•¸è‡ªå‹•ç”¢ç”Ÿ 1~N è™Ÿ
          </label>
        </div>

        <div id="manualBox">
          <textarea id="participants" placeholder="ä¾‹å¦‚ï¼š&#10;å°å¿—&#10;å°ç²’&#10;å°ç•™&#10;å°é ˜&#10;å°å¨œ"></textarea>
          <div class="hint">èªªæ˜ï¼šè½‰ç›¤ä¸Šçš„æ–‡å­—æœƒé¡¯ç¤ºé€™è£¡çš„åå­—æˆ–è™Ÿç¢¼ï¼Œæ¯å€‹äººåªæœƒä¸­ä¸€æ¬¡ã€‚</div>
        </div>

        <div id="countBox" style="display:none;">
          <label for="participantCount">åƒåŠ äººæ•¸ï¼š</label>
          <input id="participantCount" type="number" min="1" value="10" />
          <div class="hint">èªªæ˜ï¼šæœƒè‡ªå‹•ç”¢ç”Ÿã€Œ1è™Ÿï½Nè™Ÿã€ä½œç‚ºåƒåŠ è€…ã€‚</div>
        </div>
      </div>

      <div class="btn-row">
        <button id="applyBtn">å¥—ç”¨è¨­å®š</button>
      </div>

      <div class="section">
        <label>ä¸­ççµæœï¼š</label>
        <div class="result-wrapper">
          <div class="result-box" id="resultBox">
            <p style="opacity:.7;">å°šç„¡çµæœ</p>
          </div>
          <img id="catImg" src="cat.png" alt="æœ‰ç¥¨è²“è²“" />
<div class="twinzy-row">
          <img src="twinzy1.png" alt="Twinzy 1" />
          <img src="twinzy2.png" alt="Twinzy 2" />
          <img src="twinzy3.png" alt="Twinzy 3" />
          <img src="twinzy4.png" alt="Twinzy 4" />
          <img src="twinzy5.png" alt="Twinzy 5" />
        </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const resetBtn = document.getElementById("resetBtn");
    const applyBtn = document.getElementById("applyBtn");
    const statusText = document.getElementById("statusText");
    const resultBox = document.getElementById("resultBox");
    const catImg = document.getElementById("catImg");
    const drawTitleInput = document.getElementById("drawTitle");
    const pageTitleEl = document.getElementById("pageTitle");

    // ä¸­å¿ƒåå½©è™¹è²“åœ–
    const centerImg = new Image();
    centerImg.src = "apple_rainbow.png"; // è¨˜å¾—æº–å‚™é€™å¼µåœ–
    let centerImgLoaded = false;
    centerImg.onload = () => {
      centerImgLoaded = true;
      drawWheel();
    };

    let prizes = [];
    let participants = [];
    let remainingPrizes = [];
    let remainingParticipants = [];
    let isDrawing = false;
    let rotation = 0; // ç›®å‰è§’åº¦ï¼ˆå¼§åº¦ï¼‰

    // åƒåŠ è€…æ¨¡å¼é¡¯ç¤ºåˆ‡æ›
    const manualBox = document.getElementById("manualBox");
    const countBox = document.getElementById("countBox");
    const participantModeRadios = document.querySelectorAll('input[name="participantMode"]');

    participantModeRadios.forEach(radio => {
      radio.addEventListener("change", () => {
        const mode = document.querySelector('input[name="participantMode"]:checked').value;
        if (mode === "manual") {
          manualBox.style.display = "";
          countBox.style.display = "none";
        } else {
          manualBox.style.display = "none";
          countBox.style.display = "";
        }
      });
    });

    // å¥—ç”¨è¨­å®š
    applyBtn.addEventListener("click", () => {
      const prizeLines = document.getElementById("prizes").value
        .split("\n").map(s => s.trim()).filter(s => s !== "");

      // æŠ½çåç¨±
      const customTitle = drawTitleInput.value.trim();
      if (customTitle) {
        pageTitleEl.textContent = customTitle;
        document.title = customTitle;
      } else {
        pageTitleEl.textContent = "è½‰ç›¤éš¨æ©ŸæŠ½ç";
        document.title = "è½‰ç›¤éš¨æ©ŸæŠ½ç";
      }

      // åƒåŠ è€…ä¾†æºï¼šæ‰‹å‹•æˆ–äººæ•¸
      const mode = document.querySelector('input[name="participantMode"]:checked').value;
      let participantLines = [];

      if (mode === "manual") {
        participantLines = document.getElementById("participants").value
          .split("\n").map(s => s.trim()).filter(s => s !== "");
      } else {
        const countValue = parseInt(document.getElementById("participantCount").value, 10);
        if (isNaN(countValue) || countValue <= 0) {
          alert("è«‹è¼¸å…¥æ­£ç¢ºçš„åƒåŠ äººæ•¸ã€‚");
          return;
        }
        participantLines = Array.from({ length: countValue }, (_, i) => `${i + 1}è™Ÿ`);
      }

      if (prizeLines.length === 0) {
        alert("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹çå“ã€‚");
        return;
      }
      if (participantLines.length === 0) {
        alert("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹åƒåŠ è€…ã€‚");
        return;
      }
      if (participantLines.length < prizeLines.length) {
        alert("åƒåŠ è€…æ•¸é‡å¿…é ˆå¤§æ–¼æˆ–ç­‰æ–¼çå“æ•¸é‡ã€‚");
        return;
      }

      prizes = prizeLines;
      participants = participantLines;
      remainingPrizes = [...prizes];
      remainingParticipants = [...participants];
      rotation = 0;
      drawWheel();

      spinBtn.disabled = false;
      catImg.style.display = "none";
      statusText.textContent = "è¨­å®šå®Œæˆï¼Œå¯ä»¥é–‹å§‹æŠ½çå›‰ï¼";
      resultBox.innerHTML = '<p style="opacity:.7;">å°šç„¡çµæœ</p>';
    });

    // ç•«è½‰ç›¤ï¼ˆé¡¯ç¤ºçš„æ˜¯åƒåŠ è€…ï¼‰
    function drawWheel() {
      const count = remainingParticipants.length;
      const { width, height } = canvas;
      const cx = width / 2;
      const cy = height / 2;
      const radius = Math.min(cx, cy) - 8;

      ctx.clearRect(0, 0, width, height);

      if (count === 0) {
        ctx.save();
        ctx.translate(cx, cy);
        ctx.fillStyle = "#ffffffcc";
        ctx.textAlign = "center";
        ctx.font = "18px 'Noto Sans TC'";
        ctx.fillText("æ²’æœ‰äººå¯ä»¥æŠ½äº† ğŸ˜¹", 0, 0);
        ctx.restore();
        return;
      }

      const anglePer = (Math.PI * 2) / count;

      for (let i = 0; i < count; i++) {
        const startAngle = rotation + i * anglePer;
        const endAngle = startAngle + anglePer;

        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, radius, startAngle, endAngle);
        ctx.closePath();

        // Twinzy ä½é£½å’Œäº”è‰²
        const colors = [
          "#A8A5A5", // ç°
          "#9DD7D3", // è–„è·ç¶ 
          "#6FA3CC", // ä¸­è—
          "#F0D097", // æ·¡é»ƒ
          "#F3CBD4"  // æ·¡ç²‰
        ];
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();

        ctx.strokeStyle = "rgba(255,255,255,0.85)";
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.save();
        ctx.translate(cx, cy);
        const textAngle = startAngle + anglePer / 2;
        ctx.rotate(textAngle);
        ctx.textAlign = "right";
        ctx.fillStyle = "#fff";
        ctx.font = "14px 'Noto Sans TC'";
        ctx.fillText(remainingParticipants[i], radius - 10, 5);
        ctx.restore();
      }

      // ä¸­å¿ƒï¼šåå½©è™¹è˜‹æœè²“
      if (centerImgLoaded) {
        const centerSize = radius * 0.6; // ä¸­å¿ƒåœ–å¤§å°
        ctx.save();
        ctx.beginPath();
        ctx.arc(cx, cy, centerSize / 2, 0, Math.PI * 2);
        ctx.clip();
        ctx.drawImage(centerImg, cx - centerSize / 2, cy - centerSize / 2, centerSize, centerSize);
        ctx.restore();
      } else {
        // åœ–é‚„æ²’è¼‰å®Œæ™‚çš„å‚™ç”¨åœˆåœˆ
        ctx.beginPath();
        ctx.arc(cx, cy, 40, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(0,0,0,0.7)";
        ctx.fill();
        ctx.fillStyle = "#ffeb3b";
        ctx.font = "16px 'Noto Sans TC'";
        ctx.textAlign = "center";
        ctx.fillText("æŠ½ç", cx, cy + 5);
      }
    }

    // è½‰ä¸€æ¬¡ç›¤ï¼ŒæŠ½å‡ºä¸€å€‹å¾—çè€…ï¼ˆå°æ‡‰ä¸€å€‹çå“ï¼‰
    function spinOnceForPrize(prizeName) {
      return new Promise((resolve) => {
        const count = remainingParticipants.length;
        const anglePer = (Math.PI * 2) / count;

        // éš¨æ©Ÿæ±ºå®šé€™ä¸€è¼ªåœåœ¨å“ªä¸€å€‹äºº
        const targetIndex = Math.floor(Math.random() * count);
        const targetAngle = (Math.PI / 2) - (targetIndex * anglePer) - anglePer / 2; // æŒ‡é‡åœ¨ä¸Šæ–¹

        const baseRotations = Math.PI * 2 * 5;
        const finalRotation = baseRotations + targetAngle;

        const duration = 2200;
        const start = performance.now();
        const initialRotation = rotation;

        function animate(now) {
          const elapsed = now - start;
          const t = Math.min(elapsed / duration, 1);
          const ease = 1 - Math.pow(1 - t, 3);
          rotation = initialRotation + (finalRotation - initialRotation) * ease;
          drawWheel();

          if (t < 1) {
            requestAnimationFrame(animate);
          } else {
            rotation = finalRotation % (Math.PI * 2);
            drawWheel();

            // å‹•ç•«çµæŸï¼Œé¸å‡ºå¾—çè€…
            const winner = remainingParticipants.splice(targetIndex, 1)[0];
            resolve({ prize: prizeName, winner });
          }
        }

        requestAnimationFrame(animate);
      });
    }

    // é–‹å§‹æŠ½çï¼šä¸€æ¬¡æŠ½å®Œæ‰€æœ‰çå“
    async function startDraw() {
      if (isDrawing) return;
      if (remainingPrizes.length === 0) {
        alert("æ²’æœ‰å¯æŠ½çš„çå“ã€‚");
        return;
      }
      if (remainingParticipants.length < remainingPrizes.length) {
        alert("åƒåŠ è€…æ•¸é‡ä¸è¶³ä»¥åˆ†é…æ‰€æœ‰çå“ã€‚");
        return;
      }

      isDrawing = true;
      spinBtn.disabled = true;
      catImg.style.display = "none";
      if (resultBox.innerHTML.includes("å°šç„¡çµæœ")) {
        resultBox.innerHTML = "";
      }

      statusText.textContent = "è˜‹æœè²“è²“åŠªåŠ›å¹«ä½ æŠ½çä¸­â€¦";

      const currentPrizes = [...remainingPrizes];
      remainingPrizes = []; // æŠ½çè¦–ç‚ºé€™ä¸€è¼ªçå“å…¨éƒ¨ç”¨æ‰

      for (let i = 0; i < currentPrizes.length; i++) {
        const prizeName = currentPrizes[i];
        const { prize, winner } = await spinOnceForPrize(prizeName);

        const p = document.createElement("p");
        p.innerHTML = `<span class="badge">ğŸ ${prize}</span> âœ <strong>${winner}</strong>`;
        resultBox.appendChild(p);

        statusText.textContent = `æŠ½ä¸­ï¼š${prize} âœ ${winner}`;
        await new Promise(r => setTimeout(r, 300)); // æ¯è¼ªä¹‹é–“ç¨å¾®åœä¸€ä¸‹
      }

      statusText.textContent = "ğŸ‰æ­å–œæ‰€æœ‰ä¸­çè€…å–µå–µå–µå–µå–µå–µå–µğŸ‰";
      catImg.style.display = "block";
      isDrawing = false;
    }

    spinBtn.addEventListener("click", startDraw);

    resetBtn.addEventListener("click", () => {
      remainingPrizes = [...prizes];
      remainingParticipants = [...participants];
      rotation = 0;
      drawWheel();
      resultBox.innerHTML = '<p style="opacity:.7;">å°šç„¡çµæœ</p>';
      statusText.textContent = "å·²é‡ç½®çµæœï¼Œå¯ä»¥é‡æ–°é–‹å§‹æŠ½ã€‚";
      catImg.style.display = "none";
      spinBtn.disabled = remainingPrizes.length === 0 || remainingParticipants.length === 0;
    });

    // åˆå§‹ç•«é¢
    drawWheel();
  </script>
</body>
</html>
